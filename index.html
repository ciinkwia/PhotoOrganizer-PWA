<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <meta name="theme-color" content="#E53935">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>Photo Organizer</title>
  <link rel="manifest" href="manifest.json">
  <link rel="icon" href="icons/icon-192.svg" type="image/svg+xml">
  <link rel="apple-touch-icon" href="icons/icon-192.svg">
  <link rel="stylesheet" href="css/styles.css">
</head>
<body>
  <div id="app">

    <!-- Toolbar -->
    <div class="toolbar" id="toolbar">
      <button class="toolbar-btn toolbar-back" id="btnBack" aria-label="Back">â†</button>
      <h1 id="toolbarTitle">Capture</h1>
      <button class="toolbar-btn" id="btnSort" aria-label="Sort" title="Sort">â‡…</button>
    </div>

    <!-- Sort dropdown -->
    <div class="sort-menu" id="sortMenu">
      <button class="sort-option active" data-sort="DATE_ADDED_DESC">Newest first</button>
      <button class="sort-option" data-sort="DATE_ADDED_ASC">Oldest first</button>
      <button class="sort-option" data-sort="NAME_ASC">Name A-Z</button>
      <button class="sort-option" data-sort="NAME_DESC">Name Z-A</button>
      <button class="sort-option" data-sort="SIZE_DESC">Largest first</button>
      <button class="sort-option" data-sort="SIZE_ASC">Smallest first</button>
    </div>

    <!-- Selection bar -->
    <div class="selection-bar" id="selectionBar">
      <button id="selClear" aria-label="Clear selection">âœ•</button>
      <span class="sel-count" id="selCount">0 selected</span>
      <button id="selSelectAll" title="Select all">â˜</button>
      <button id="selMove" title="Move to folder">ğŸ“</button>
      <button id="selTag" title="Add tag">ğŸ·</button>
      <button id="selFav" title="Toggle favorite">â™¡</button>
      <button id="selDelete" title="Delete">ğŸ—‘</button>
    </div>

    <!-- Pages -->
    <div class="pages">

      <!-- Capture / Session page -->
      <div class="page active" id="pageGallery">
        <!-- Idle state: no session active -->
        <div id="sessionIdle" class="session-idle">
          <div class="session-idle-icon">ğŸ“·</div>
          <p class="session-idle-text">Start a session to capture photos, screenshots, and downloads into one folder</p>
          <button class="session-start-btn" id="btnSessionStart">Start Session</button>
        </div>

        <!-- Active state: session running -->
        <div id="sessionActive" class="session-active hidden">
          <div class="session-rec-bar">
            <span class="rec-dot"></span>
            <span class="rec-label">Recording to</span>
            <span class="rec-folder-name" id="sessionFolderName"></span>
          </div>

          <!-- Quick-capture action row -->
          <div class="capture-actions" id="captureActions">
            <button class="capture-btn" id="btnTakePhoto">
              <span class="capture-btn-icon">ğŸ“¸</span>
              <span>Take Photo</span>
            </button>
            <button class="capture-btn" id="btnScreenshot">
              <span class="capture-btn-icon">ğŸ–¥</span>
              <span>Screenshot</span>
            </button>
            <button class="capture-btn" id="btnImportFiles">
              <span class="capture-btn-icon">ğŸ“</span>
              <span>Import</span>
            </button>
          </div>

          <div class="capture-hint" id="captureHint">
            <span>ğŸ’¡</span> Paste screenshots with Ctrl+V &nbsp;Â·&nbsp; Drag &amp; drop images below
          </div>

          <div class="session-drop-zone" id="dropZone">
            <div class="drop-zone-content">
              <div class="drop-zone-icon">ğŸ“¥</div>
              <p>Drag &amp; drop images here</p>
            </div>
          </div>
          <div class="session-photo-count" id="sessionPhotoCount"></div>
          <div class="photo-grid" id="sessionGrid"></div>
          <button class="session-stop-btn" id="btnSessionStop">Stop Session</button>
        </div>
      </div>

      <!-- Folders page -->
      <div class="page" id="pageFolders">
        <div class="empty-state" id="foldersEmpty">
          <div class="empty-icon">ğŸ“‚</div>
          <p>No folders yet.<br>Create a folder to organize your photos.</p>
        </div>
        <div id="folderList"></div>
      </div>

      <!-- Folder detail page -->
      <div class="page" id="pageFolderDetail">
        <div class="empty-state" id="folderDetailEmpty">
          <div class="empty-icon">ğŸ“‚</div>
          <p>This folder is empty.<br>Move photos here from the gallery.</p>
        </div>
        <div class="photo-grid" id="folderDetailGrid"></div>
      </div>

      <!-- Search page -->
      <div class="page" id="pageSearch">
        <div class="search-tabs" id="searchTabs">
          <button class="search-tab active" data-mode="ALL">All</button>
          <button class="search-tab" data-mode="BY_NAME">Name</button>
          <button class="search-tab" data-mode="BY_TAG">Tag</button>
          <button class="search-tab" data-mode="BY_DATE">Date</button>
        </div>
        <div class="search-bar" id="searchBarWrap">
          <input type="text" class="search-input" id="searchInput" placeholder="Search photosâ€¦">
        </div>
        <div class="chip-row hidden" id="searchTagChips"></div>
        <div class="date-range-row hidden" id="searchDateRange">
          <input type="date" class="date-input" id="dateFrom" placeholder="From">
          <input type="date" class="date-input" id="dateTo" placeholder="To">
        </div>
        <div class="empty-state hidden" id="searchEmpty">
          <div class="empty-icon">ğŸ”</div>
          <p>No results found.</p>
        </div>
        <div class="photo-grid" id="searchGrid"></div>
      </div>

      <!-- Tags page -->
      <div class="page" id="pageTags">
        <div class="empty-state" id="tagsEmpty">
          <div class="empty-icon">ğŸ·</div>
          <p>No tags yet.<br>Create tags to categorize your photos.</p>
        </div>
        <div id="tagList"></div>
      </div>
    </div>

    <!-- Bottom Navigation -->
    <nav class="bottom-nav" id="bottomNav">
      <button class="nav-item active" data-page="gallery">
        <span class="nav-icon">ğŸ“·</span>
        <span>Capture</span>
      </button>
      <button class="nav-item" data-page="folders">
        <span class="nav-icon">ğŸ“</span>
        <span>Folders</span>
      </button>
      <button class="nav-item" data-page="search">
        <span class="nav-icon">ğŸ”</span>
        <span>Search</span>
      </button>
      <button class="nav-item" data-page="tags">
        <span class="nav-icon">ğŸ·</span>
        <span>Tags</span>
      </button>
    </nav>

    <!-- FAB -->
    <button class="fab" id="fab" aria-label="Add">+</button>

    <!-- Photo Detail View -->
    <div class="photo-detail-view" id="photoDetail">
      <div class="photo-detail-toolbar">
        <button id="detailBack" aria-label="Back">â†</button>
        <span class="photo-name" id="detailName"></span>
        <button id="detailFav" aria-label="Favorite">â™¡</button>
        <button id="detailDelete" aria-label="Delete">ğŸ—‘</button>
      </div>
      <div class="photo-detail-image">
        <img id="detailImg" src="" alt="">
      </div>
      <div class="photo-detail-info" id="detailInfo">
        <div class="info-row"><span class="info-label">Date</span><span class="info-value" id="infoDate">-</span></div>
        <div class="info-row"><span class="info-label">Size</span><span class="info-value" id="infoSize">-</span></div>
        <div class="info-row"><span class="info-label">Dimensions</span><span class="info-value" id="infoDims">-</span></div>
        <div class="info-row"><span class="info-label">Folder</span><span class="info-value" id="infoFolder">-</span></div>
        <div class="photo-detail-tags">
          <div class="section-label">Tags</div>
          <div class="chip-row" id="detailTags"></div>
        </div>
        <div class="photo-detail-actions">
          <button class="detail-action-btn" id="detailRename">âœ Rename</button>
          <button class="detail-action-btn" id="detailMove">ğŸ“ Move</button>
          <button class="detail-action-btn" id="detailAddTag">ğŸ· Tag</button>
        </div>
      </div>
    </div>

    <!-- Snackbar -->
    <div class="snackbar" id="snackbar"></div>

    <!-- Modal overlay (reusable) -->
    <div class="modal-overlay" id="modalOverlay">
      <div class="modal" id="modalContent"></div>
    </div>

    <!-- Context menu (reusable) -->
    <div class="context-menu" id="contextMenu"></div>

    <!-- Hidden file inputs -->
    <input type="file" id="fileInput" accept="image/*" multiple hidden>
    <input type="file" id="cameraInput" accept="image/*" capture="environment" hidden>
  </div>

  <script src="js/db.js"></script>
  <script src="js/app.js"></script>
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js');
    }
  </script>
</body>
</html>
